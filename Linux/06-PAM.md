# Linux 下可插入身份验证模块 `Linux-PAM`

| `Linux-PAM`  | 概念描述                                                                     |
| ------------ | ---------------------------------------------------------------------------- |
| 简称         | `PAM`                                                                        |
| 全称         | `Pluggable Authentication Modules`                                           |
| 中文名       | `Linux 可插入身份验证模块`                                                   |
| 具体效果     | 将程序开发与认证方式进行分离，程序在运行时调用附加的“认证”模块完成自己的工作 |
| 优势         | 使本地系统管理员通过配置，自由选择要使用哪些认证模块                         |
| 模块路径     | `/usr/lib/x86_64-linux-gnu/security`                                         |
| 配置文件路径 | `/etc/pam.d/` 目录下的一系列配置文件                                         |
| 官方地址     | http://www.linux-pam.org/                                                    |

> 提示：上文指的是 `Debian10.x` 下的 PAM 模块路径，其他发行版路径可能不一样！

## 一个案例带你了解 `Linux-PAM` 是什么？

`su` 是一个很常用的 Linux 命令，可以让我们从一个用户切换到另一个用户。

> `su` 功能

| 登陆用户 | `su` 操作       | 密码认证 |
| -------- | --------------- | -------- |
| root     | `su` 到别的用户 | 不需要   |
| 其它用户 | `su` 到别的用户 | 需要密码 |

> `su` 命令切换用户的过程:

| 过程 | 描述                                         |
| ---- | -------------------------------------------- |
| 01   | 认证登陆用户是 `root`，不需要目标用户的密码  |
| 02   | 认证登陆用户不是 `root` ，需要目标用户的密码 |
| 03   | 认证成功，启动相应的 `Shell`                 |

> 提示：`bash` `zsh` 等都是 Linux 的 Shell

让我们来关注一下 `su` 的认证功能。按照正常的逻辑， `su` 的开发人员很可能会自己写出认证的功能：先判断是不是 root，是则判定认证通过；不是则要求用户输入目标账号的密码，匹配成功则认证通过，否则不通过。这套逻辑并不复杂，开发人员开发出来便是了。

过了几天，用户提出了这样的一个需求：运维团队都属于 wheel 组，能不能让 wheel 组的用户也能不输入密码而使用 `su` 切换？看起来也不是什么特别困难的需求，开发人员本可以满足就是了。但是如果再过几天，运维小张考虑到安全想要 `su` 有短信验证码功能，而用户小王为了方便测试想要一个完全不用密码的 `su`。认证需求的差异化越来越明显，开发人员的工作也变得越来越困难。

这时，PAM 出现了。PAM 对开发人员说：“认证的事情交给我，你只要告诉我你想做用户认证就好，余下的事情由我来解决，能不能通过由我来说了算。”它又对运维人员说：“你们来我这里编写你们想要的针对 `su` 的认证策略吧，我将充分保证功能的灵活。”

这下好办了。`su` 的开发人员可以专注地为用户启动 Shell 服务，而不需要关心用户认证的细节了；用户或复杂、或简单的认证需求也都得到了满足。真是皆大欢喜。

| 案例来源 | 详情                                                                 |
| -------- | -------------------------------------------------------------------- |
| 作者     | `一言不合_c8a0`                                                      |
| 链接     | https://www.jianshu.com/p/760f239be916                               |
| 来源     | 简书                                                                 |
| 版权     | 著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。 |
